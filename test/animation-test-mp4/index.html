<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Scroll Animation - Video</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #000;
            color: white;
        }

        .spacer {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            text-align: center;
        }

        .animation-section {
            height: 500vh; /* 5x a altura da tela para dar mais espaço para animação */
            position: relative;
        }

        .animation-container {
            position: sticky;
            top: 0;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .animation-video {
            width: 80%;
            max-width: 800px;
            height: auto;
            object-fit: contain;
        }

        .scroll-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.8);
            color: black;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div class="spacer">
        <div>
            <h1>Scroll Animation Test - Video</h1>
            <p>Role para baixo para ver a animação em vídeo</p>
        </div>
    </div>

    <div class="animation-section">
        <div class="animation-container">
            <video 
                id="animationVideo" 
                class="animation-video" 
                muted 
                preload="metadata"
                disablePictureInPicture
                controlsList="nodownload nofullscreen noremoteplayback"
            >
                <source src="test.mp4" type="video/mp4">
                Seu navegador não suporta vídeo HTML5.
            </video>
        </div>
    </div>

    <div class="spacer">
        <div>
            <h2>Fim da Animação</h2>
            <p>A animação em vídeo terminou!</p>
        </div>
    </div>

    <div class="scroll-indicator" id="scrollIndicator">
        Progress: 0% | Time: 0.00s
    </div>

    <script>
        // ===== CONFIGURAÇÃO DE VELOCIDADE =====
        // Altere este valor para controlar a velocidade:
        // 1.0 = velocidade normal
        // 2.0 = 2x mais rápido (menos scroll necessário)
        // 0.5 = 2x mais lento (mais scroll necessário)
        const ANIMATION_SPEED = 1.0;
        // ======================================
        
        const video = document.getElementById('animationVideo');
        const scrollIndicator = document.getElementById('scrollIndicator');
        let videoDuration = 0;
        let isVideoReady = false;

        // Aguardar o vídeo carregar os metadados
        video.addEventListener('loadedmetadata', () => {
            videoDuration = video.duration;
            isVideoReady = true;
            adjustSectionHeight();
            updateVideoFrame();
        });
        
        // Ajustar altura da seção baseada na velocidade
        function adjustSectionHeight() {
            const animationSection = document.querySelector('.animation-section');
            const baseHeight = 500; // 500vh original
            const adjustedHeight = baseHeight / ANIMATION_SPEED;
            animationSection.style.height = adjustedHeight + 'vh';
        }

        // Prevenir reprodução automática
        video.addEventListener('loadstart', () => {
            video.currentTime = 0;
        });

        function updateVideoFrame() {
            if (!isVideoReady) return;

            const animationSection = document.querySelector('.animation-section');
            const rect = animationSection.getBoundingClientRect();
            const sectionTop = rect.top + window.pageYOffset;
            const sectionHeight = animationSection.offsetHeight;
            const scrollTop = window.pageYOffset;
            
            // Calcular quando a animação deve começar e terminar
            const viewportHeight = window.innerHeight;
            const sectionStart = sectionTop;
            const sectionEnd = sectionTop + sectionHeight - viewportHeight;
            
            let animationProgress = 0;
            
            if (scrollTop >= sectionStart && scrollTop <= sectionEnd) {
                // Calcular progresso dentro da seção de animação
                const relativeScroll = scrollTop - sectionStart;
                const totalAnimationDistance = sectionEnd - sectionStart;
                animationProgress = Math.min(relativeScroll / totalAnimationDistance, 1);
            } else if (scrollTop > sectionEnd) {
                animationProgress = 1;
            }
            
            
            // Mapear progresso para tempo do vídeo
            const targetTime = animationProgress * videoDuration;
            
            // Atualizar tempo do vídeo (sem reproduzir)
            if (Math.abs(video.currentTime - targetTime) > 0.1) {
                video.currentTime = targetTime;
            }
            
            // Atualizar indicador
            scrollIndicator.textContent = `Progress: ${Math.round(animationProgress * 100)}% | Time: ${targetTime.toFixed(2)}s`;
        }

        // Otimizar com requestAnimationFrame
        let ticking = false;
        function requestTick() {
            if (!ticking) {
                requestAnimationFrame(updateVideoFrame);
                ticking = true;
            }
        }

        window.addEventListener('scroll', () => {
            requestTick();
            ticking = false;
        });

        // Prevenir controles do usuário
        video.addEventListener('play', (e) => {
            e.preventDefault();
            video.pause();
        });

        video.addEventListener('seeking', () => {
            // Permitir seeking programático
        });

        // Inicializar quando a página carregar
        window.addEventListener('load', () => {
            adjustSectionHeight();
            updateVideoFrame();
        });
    </script>
</body>
</html>